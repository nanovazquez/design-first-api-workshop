# Exercise 2: Using the autogenerated Client SDK to develop a user interface

In this exercise, you will learn how to connect a client to your newly created API definition. This will help your team to develop a UI (web-based, mobile, etc.) using a clear contract and without worrying about the backend implementation. For this, you will generate a Client SDK directly from the API definition that will encapsulate the logic to connect to the API and make calls to retrieve data from it.

In order to that, we need to make sure a few things are properly set:

## Ensure API Auto Mocking integration is on

The **API Auto Mocking integration** auto-generates a mocked backend directly from your API definition on every Save. It is enabled by default in your API and you easily validate it by just checking that this code snippet is present in your API definition.

```
swagger: '2.0'
...
# Added by API Auto Mocking Plugin
host: virtserver.swaggerhub.com
basePath: /nanovazquez/nodeconf-api/1.0.0
schemes:
 - https
```

In case it is not turned on, follow these steps:

1. Open [SwaggerHub](app.swaggerhub.com/) and navigate to your API definition.
1. Click the API name (`nodeconf-api`) located in the top left section of the page.
1. Switch to the `Integrations` tab.
1. Check that the `API Auto Mocking` item is there and it's on

![API Auto Mocking integration](./assets/api-auto-mocking-integration.jpg)

> **Note:** Learn more about this integration and what you can do with it [here](https://app.swaggerhub.com/help/integrations/api-auto-mocking).

## Introducing the NodeConf Argentina 2018 app

In the **begin** folder of this exercise you can find the **nodeconf-arg-2018** app. This web-based UI was created using [Create React app](https://github.com/facebook/create-react-app) with the sole purpose of displaying the agenda of our conference. It is a very basic, rough implementation, but we are going to use it to showcase how **any** client can connect to your API definition by following a very few simple steps.

Before starting this exercise, try running this app locally by following these steps:

1. Open a terminal in the **exercise-2/begin/nodeconf-client-ui** folder.
1. Run `npm install` to install all the dependencies of this project.
1. After all packages were installed, run `npm start` to initialize the app in the development server. This script will also open a browser tab and display the UI, which is served by default in http://localhost:3000. If everything is OK, you should see something like this:

   ![NodeConf Argentina 2018 UI](./assets/nodeconf-arg-2018.png)

One of the benefits of _Create React app_ is that any changes you make to the codebase in later steps refresh the UI automatically, so you never need to stop & restart the project.

Now that we have a UI, let's learn how to connect it with our API.

> **Note:** You can find more information about React and Create React app [here](https://github.com/facebook/create-react-app).

## Creating the SDK of your API

### Configure the Codegeneration Options

1.  From SwaggerHub, while you are editing your API, go to `Export > Codegen Options` in the upper-right corner.

    ![Codegen menu entry](./assets/codegen-menu-entry.jpg)

2.  In the options pop-up modal, search for `typescript-fetch` in the `Clients` section. and select it. In there, set the
    following values:

    - _(Optional)_ supportES6: `true`
    - npmVersion: The version of the npm package that will be the Client SDK. Example: `1.0.0`
    - npmName: The name of the npm package that will be the Client SDK. Example: `nodeconf-api`

    ![Client SDK options](./assets/client-sdk-options-highlighted.jpg)

3.  Click the `Save` button

    ![Codegen save button](./assets/codegen-save-button.jpg)

### Download the Client SDK

1.  From SwaggerHub, while you are editing your API, go to `Export > Client SDK > typescript-fetch` in the upper-right
    corner, which will download the Client SDK.

        Since you have now set some codegen option for that Client SDK (see previous step), it will display a `*` next to
        the menu entry.

    ![Client SDK Download](./assets/client-sdk-download.jpg)

2.  Unzip the downloaded file.

3.  In the unzipped folder, run `npm install`. This will install the dependencies that the SDK requires and transpile the
    typescript SDK to javascript.

## Integrate the SDK with a client

There are a number of possible approaches to do this:

- Publish the Client SDK to `npm` and install that package from npm in the UI project, or
- Use `npm link` to use the local Client SDK you've downloaded in your machine from the UI project, or
- In the UI project, `require`/`import` the path to your local Client SDK folder.

For the purpose of this workshop, we recommend either linking the local package or importing the local folder directly.
Therefore, **choose one of the following approaches**.

#### To `npm link` the local package

> This approach is similar to publishing the package to `npm` and then downloading it.

1. From the directory of the downloaded client SDK, run `npm link`
1. From the directory of the client UI, run `npm link <your-client-sdk-package-name>` (use the name you've set in the
   Codegen options, e.g. `nodeconf-api`, and _not_ the directory name).
1. Then, from the UI code you can `require`/`import` the package using that name (e.g. `nodeconf-api`) in the `src/App.js` file.

   ```js
   // Replace the package name with what your client sdk package name
   import { DefaultApi } from "nodeconf-api";
   ```

### To require/import the local package

> This approach is similar to just adding the client SDK code as part of your UI's repository.

1.  Move the downloaded client SDK code to a folder within the `src/` directory inside the UI code, or create a symlink
    there to where you've downloaded (run `ln -s ~/Downloads/typescript-fetch-client-generated .` from within the `src/`
    folder).

1.  Then, from the UI code, simply `require`/`import` the path to the folder containing the SDK instead of a
    package name that is in the UI's `package.json` in the `src/App.js` file.

    ```js
    // Replace the path with that of the folder with the client SDK in your machine
    // (it has to be within the src/ folder, you cannot import files outside the scope of your UI project)
    import { DefaultApi } from "./typescript-fetch-client-generated";
    ```

### Use the SDK

Now that you have the client SDK added to our UI, it's time to actually make requests to the (auto-mocked) backend!

1. Instantiate the imported `DefaultApi` by doing:

   ```js
   const api = new DefaultApi();
   ```

1. Call the backend to fetch the event speakers list by doing:

   ```js
   // The following line returns a Promise that either resolves to the response body, or rejects with the entire
   // response object (when the status code is not 2xx).
   api.editionsEditionIdSpeakersGet(2018);
   ```

That's it! You've now called the auto-mocked backend to fetch the list of speakers :tada:

# Final exercise comments

- There are actually other ways to use the client SDK. The above example uses its object-oriented interface, but it also
  exposes an interface more aimed at functional programming (check `DefaultApiFp` in the autogenerated code).

- By default, the client SDK uses [isomorphic-fetch](https://www.npmjs.com/package/portable-fetch), but it also allows
  you to pass in other implementations of `fetch` if you prefer. This may be useful to use together with
  [zipkin](https://www.npmjs.com/package/zipkin-instrumentation-fetch), for example.

- The client SDK by default uses the backend URL that you've specified in your OAS Document, but it can be overridden in
  the code (see the next exercise! :smirk:).
