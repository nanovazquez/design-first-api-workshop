# Exercise 2: Autogenerating a client SDK and connecting to the auto-mocked backend

In this exercise, you will connect a UI to the auto-mocked backend so that you can develop the client/UI that will
consume the API without having to implement the server first. To do so, you'll generate a Client SDK directly from
the API Specification, without manually coding the API calls.

In order to do so, we'll have to:
- Ensure that the API Auto Mocking integration is on
- Set up the given UI that will call the specified API
- Configure some options for the autogenerated client SDK
- Generate that Client SDK
- Add that SDK to our UI
- Use that SDK in our UI to integrate with the auto-mocked backend

## Ensure API Auto Mocking integration is on

API Auto Mocking provides a mocked backend autogenerated from the OAS Document. It is an integration of SwaggerHub which
is on by default, but let's check just in case that it's on. To do so, click the `API integrations` button on the upper
right side. You should see the `API Auto Mocking` item in there, meaning that it is already added to your API.

![API Auto Mocking integration](./assets/api-auto-mocking-integration.jpg)

## Set up the UI

[TODO]

## Configure the Codegeneration Options

1. From SwaggerHub, while you are editing your API, go to `Export > Codegen Options` in the upper-right corner.

    ![Codegen menu entry](./assets/codegen-menu-entry.jpg)

2. In the options pop-up modal, search for `typescript-fetch` in the `Clients` section. and select it. In there, set the
following values:
    - _(Optional)_ supportES6: `true`
    - npmVersion: The version of the npm package that will be the Client SDK. Example: `1.0.0`
    - npmName: The name of the npm package that will be the Client SDK. Example: `nodeconf-api`

    ![Client SDK options](./assets/client-sdk-options.jpg)


## Download the Client SDK

1. From SwaggerHub, while you are editing your API, go to `Export > Client SDK > typescript-fetch` in the upper-right
corner, which will download the Client SDK.

    Since you have now set some codegen option for that Client SDK (see previous step), it will display a `*` next to
    the menu entry.

    ![Client SDK Download](./assets/client-sdk-download.jpg)

2. Unzip the downloaded file.

3. In the unzipped folder, run `npm install`. This will install the dependencies that the SDK requires and transpile the
typescript SDK to javascript.

## Add that SDK to our UI

There are a number of possible approaches to do this:
- Publish the Client SDK to `npm` and install that package from npm in the UI project, or
- Use `npm link` to use the local Client SDK you've downloaded in your machine from the UI project, or
- In the UI project, `require`/`import` the path to your local Client SDK folder.

For the purpose of this workshop, we recommend either linking the local package or importing the local folder directly.
Therefore, **choose one of the following approaches**.

### To `npm link` the local package

1. From the directory of the downloaded client SDK, run `npm link`
1. From the directory of the client UI, run `npm link <your-client-sdk-package-name>` (use the name you've set in the
Codegen options, e.g. `nodeconf-api`, and *not* the directory name).
1. Then, from the UI code you can `require`/`import` the package using that name (e.g. `nodeconf-api`).

### To require/import the local package

From the UI code, `require`/`import` the path to the folder containing the SDK instead of a package name that is in the
UI's `package.json`. This approach is similar to just adding the client SDK code as part of your UI's repository.

## Use the SDK

Now that you have the client SDK added to our UI, it's time to actually make requests to the (auto-mocked) backend!

[TODO make the following prettier, this just a quick reference]

```js
// Replace the path with that of the client SDK directory, or with the client SDK
// package name if you've used `npm link` or published the package to a registry
const SDK = require('./typescript-fetch-client-generated');

const apiClient = new SDK.DefaultApi(/*{basePath: 'http://localhost:9999/nodeconf-api'*/});

apiClient.editionsEditionIdActivitiesGet(18).then(console.log);

apiClient.editionsEditionIdFeedbackPost(18, 'tobi', 'awesome!').then(console.log);
```
